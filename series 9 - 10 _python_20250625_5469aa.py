import nbformat as nbf
from nbformat.v4 import new_markdown_cell, new_notebook

# ایجاد نوت‌بوک جدید
nb = new_notebook()

# افزودن عنوان اصلی
nb.cells.append(new_markdown_cell("""
# سوالات پیشرفته مخابرات دیجیتال و آنالوگ
**سری 9 و 10 - مسائل طراحی و بهینه‌سازی سیستم‌های مخابراتی**
"""))

# سری 9
nb.cells.append(new_markdown_cell("## سری 9: مسائل پیشرفته مدولاسیون"))

# سوال 9-1
nb.cells.append(new_markdown_cell("""
### سوال 1: محاسبه بازده طیفی در 32-PSK
سیستم 32-PSK با نرخ سمبل ۱.۲۵ مگا سمبل بر ثانیه کار می‌کند.  
- الف) نرخ داده (\\(R_b\\)) را محاسبه کنید.  
- ب) اگر پهنای باند سیستم ۸۰۰ کیلوهرتز باشد، بازده طیفی چقدر است؟  

**پاسخ:**  
- الف)  
\\[
R_b = R_s \\times \\log_2(32) = 1.25 \\times 5 = 6.25 \\text{ Mbps}
\\]  
- ب)  
\\[
\\text{بازده طیفی} = \\frac{R_b}{BW} = \\frac{6.25}{0.8} = 7.8125 \\text{ bps/Hz}
\\]
"""))

# سوال 9-2
nb.cells.append(new_markdown_cell("""
### سوال 2: تحلیل خطا در 16-QAM
در سیستم 16-QAM با \\(E_b/N_0 = 12 \\text{ dB}\\)، احتمال خطای سمبل (\\(P_e\\)) را محاسبه کنید.  

**پاسخ:**  
\\[
12 \\text{ dB} = 15.85 \\implies \\sqrt{\\frac{4 \\times 15.85}{5}} = \\sqrt{12.68} \\approx 3.56
\\]  
\\[
P_e \\approx 3Q(3.56) \\approx 3 \\times 0.0002 = 0.0006 \\text{ (۰.۰۶٪)}
\\]
"""))

# سوال 9-3
nb.cells.append(new_markdown_cell("""
### سوال 3: طراحی سیستم FSK با محدودیت پهنای باند
می‌خواهید یک سیستم FSK با نرخ داده ۱ Mbps طراحی کنید. اگر حداکثر پهنای باند مجاز ۱.۲ MHz باشد:  
- الف) حداکثر فاصله فرکانسی مجاز بین سمبل‌ها چقدر است؟  
- ب) آیا این طراحی امکان‌پذیر است؟  

**پاسخ:**  
- الف) طبق قاعده کارسون:  
\\[
BW = 2(\\Delta f + R_b) \\implies 1.2 = 2(\\Delta f + 1) \\implies \\Delta f = -0.4 \\text{ MHz}
\\]  
- ب) **خیر**، زیرا فاصله فرکانسی منفی می‌شود (محدودیت پهنای باند بسیار شدید است).
"""))

# سوال 9-4
nb.cells.append(new_markdown_cell("""
### سوال 4: محاسبه توان در مدولاسیون VSB
سیگنال VSB با معادله \\(s(t) = 10\\cos(2\\pi 10^6 t) + 2\\cos(2\\pi 1.1 \\times 10^6 t)\\) داده شده است. توان کل سیگنال را محاسبه کنید.  

**پاسخ:**  
\\[
P = \\frac{10^2}{2} + \\frac{2^2}{2} = 50 + 2 = 52 \\text{ وات}
\\]
"""))

# سوال 9-5
nb.cells.append(new_markdown_cell("""
### سوال 5: تحلیل سیگنال AM با مؤلفه هارمونیک
سیگنال پیام \\(m(t) = 2\\cos(2\\pi 500 t) + \\cos(2\\pi 1000 t)\\) با حامل \\(c(t) = 20\\cos(2\\pi 10^6 t)\\) مدوله AM می‌شود.  
- الف) معادله سیگنال مدوله‌شده را بنویسید.  
- ب) پهنای باند سیگنال AM چقدر است؟  

**پاسخ:**  
- الف)  
\\[
s(t) = 20[1 + 0.5(2\\cos(2\\pi 500 t) + \\cos(2\\pi 1000 t))]\\cos(2\\pi 10^6 t)
\\]  
- ب)  
\\[
BW = 2 \\times \\text{بیشترین فرکانس پیام} = 2 \\times 1000 = 2 \\text{ kHz}
\\]
"""))

# سری 10
nb.cells.append(new_markdown_cell("## سری 10: مسائل طراحی سیستم"))

# سوال 10-1
nb.cells.append(new_markdown_cell("""
### سوال 1: بهینه‌سازی پهنای باند در OFDM
سیستم OFDM با ۶۴ زیرحامل و فاصله ۱۵ kHz بین آن‌ها طراحی شده است.  
- الف) پهنای باند کل چقدر است؟  
- ب) اگر از ۶۴-QAM استفاده شود، نرخ داده کل چقدر است؟  

**پاسخ:**  
- الف)  
\\[
BW = 64 \\times 15 \\text{ kHz} = 960 \\text{ kHz}
\\]  
- ب)  
\\[
R_b = 64 \\times \\log_2(64) \\times 15 \\text{ kbps} = 64 \\times 6 \\times 15 = 5.76 \\text{ Mbps}
\\]
"""))

# سوال 10-2
nb.cells.append(new_markdown_cell("""
### سوال 2: مقایسه نرخ خطا در PSK و FSK
در شرایط یکسان \\(E_b/N_0 = 8 \\text{ dB}\\)، احتمال خطای بیت را برای BPSK و BFSK محاسبه و مقایسه کنید.  

**پاسخ:**  
- **BPSK:**  
\\[
P_e = Q(\\sqrt{2 \\times 6.31}) \\approx Q(3.55) \\approx 0.0002
\\]  
- **BFSK:**  
\\[
P_e = Q(\\sqrt{6.31}) \\approx Q(2.51) \\approx 0.006
\\]  
**نتیجه:** BPSK عملکرد بهتری دارد.
"""))

# سوال 10-3
nb.cells.append(new_markdown_cell("""
### سوال 3: محاسبات پیشرفته شاخص مدولاسیون FM
سیگنال پیام \\(m(t) = 4\\cos(2\\pi 1 \\text{ kHz} t) + 2\\cos(2\\pi 2 \\text{ kHz} t)\\) به سیستم FM با \\(k_f = 10 \\text{ kHz/V}\\) اعمال می‌شود.  
- الف) انحراف فرکانسی حداکثر چقدر است؟  
- ب) شاخص مدولاسیون مؤثر (\\(\\beta_{eff}\\)) را محاسبه کنید.  

**پاسخ:**  
- الف)  
\\[
\\Delta f = k_f \\times \\max|m(t)| = 10 \\times 6 = 60 \\text{ kHz}
\\]  
- ب)  
\\[
\\beta_{eff} = \\frac{\\Delta f}{f_{m,\\text{avg}}} = \\frac{60}{1.5 \\text{ kHz}} = 40
\\]
"""))

# سوال 10-4
nb.cells.append(new_markdown_cell("""
### سوال 4: طراحی سیستم QAM با محدودیت توان
می‌خواهید یک سیستم ۱۶-QAM با حداکثر توان ارسال ۵۰ وات طراحی کنید. اگر دامنه هر نقطه در صورت سیگنالینگ ۲ ولت باشد:  
- الف) آیا این طراحی امکان‌پذیر است؟  
- ب) اگر نه، دامنه را چقدر کاهش دهید؟  

**پاسخ:**  
- الف) توان هر سمبل:  
\\[
P = \\frac{A^2}{2} \\times \\text{توسط نقاط} \\implies 50 = \\frac{2^2}{2} \\times 16 \\implies 50 \\neq 32
\\]  
**خیر**، توان کافی نیست.  
- ب) کاهش دامنه:  
\\[
A = \\sqrt{\\frac{50}{16 \\times 0.5}} = \\sqrt{6.25} = 2.5 \\text{ V}
\\]
"""))

# سوال 10-5
nb.cells.append(new_markdown_cell("""
### سوال 5: تحلیل سیگنال دیجیتال در کانال نویزی
سیستم BPSK با نرخ داده ۲ Mbps در کانالی با \\(N_0 = 10^{-12} \\text{ W/Hz}\\) کار می‌کند. اگر حداقل توان دریافتی برای \\(P_e \\leq 10^{-6}\\) مورد نیاز باشد، توان دریافتی (\\(P_r\\)) چقدر باید باشد؟  

**پاسخ:**  
\\[
P_e = 10^{-6} \\implies Q^{-1}(10^{-6}) \\approx 4.75 \\implies \\frac{E_b}{N_0} = \\frac{4.75^2}{2} \\approx 11.28
\\]  
\\[
P_r = E_b \\times R_b = 11.28 \\times 10^{-12} \\times 2 \\times 10^6 = 22.56 \\text{ μW}
\\]
"""))

# ذخیره فایل
with open('سوالات_پیشرفته_مخابرات_سری_9_10.ipynb', 'w', encoding='utf-8') as f:
    nbf.write(nb, f)

print("فایل Jupyter Notebook با موفقیت ایجاد شد!")