import nbformat as nbf
from nbformat.v4 import new_markdown_cell, new_notebook

# ایجاد نوت‌بوک جدید
nb = new_notebook()

# افزودن عنوان اصلی
nb.cells.append(new_markdown_cell("""
# سوالات و پاسخ‌های پیشرفته مخابراتی
**سری 4 و 5 - مسائل ترکیبی و چالشی**
"""))

# سری 4
nb.cells.append(new_markdown_cell("## سری 4: مسائل محاسباتی پیشرفته"))

# سوال 4-1
nb.cells.append(new_markdown_cell("""
### سوال 1: محاسبات عمق مدولاسیون AM
سیگنال پیام \\( m(t) = 3\\cos(2\\pi 500 t) \\) با حامل \\( c(t) = 8\\cos(2\\pi 10^5 t) \\) مدوله می‌شود. اگر حداکثر دامنه سیگنال مدوله‌شده 12 ولت باشد، ضریب مدولاسیون (\\( \\mu \\)) را محاسبه کنید.

**پاسخ:**  
معادله سیگنال AM:
\\[
s(t) = A_c[1 + \\mu m(t)]\\cos(2\\pi f_c t) = 8[1 + \\mu \\cdot 3\\cos(2\\pi 500 t)]\\cos(2\\pi 10^5 t)
\\]
حداکثر دامنه زمانی رخ می‌دهد که \\( \\cos(2\\pi 500 t) = 1 \\):
\\[
12 = 8(1 + 3\\mu) \\implies 1 + 3\\mu = 1.5 \\implies \\mu = \\frac{0.5}{3} \\approx 0.1667
\\]
"""))

# سوال 4-2
nb.cells.append(new_markdown_cell("""
### سوال 2: محاسبه توان در مدولاسیون DSB-SC
سیگنال \\( s(t) = 4\\cos(2\\pi 800 t)\\cos(2\\pi 10^6 t) \\) را در نظر بگیرید. 
1. توان سیگنال را محاسبه کنید.
2. اگر این سیگنال به یک مقاومت 50 اهمی اعمال شود، توان تحویل داده شده چقدر است؟

**پاسخ:**  
1. توان سیگنال:
\\[
P = \\frac{A_c^2 \\cdot A_m^2}{8} = \\frac{4^2 \\cdot 1^2}{8} = 2 \\text{ وات}
\\]
(توجه: \\( m(t) = \\cos(2\\pi 800 t) \\implies A_m = 1\\))

2. توان تحویل داده شده به مقاومت:
\\[
P = \\frac{V_{rms}^2}{R} = \\frac{(4/\\sqrt{2})^2}{50} = \\frac{8}{50} = 0.16 \\text{ وات}
\\]
"""))

# سوال 4-3
nb.cells.append(new_markdown_cell("""
### سوال 3: محاسبه پهنای باند در QAM
یک سیستم 64-QAM با نرخ سمبل \\( R_s = 2 \\) مگا سمبل بر ثانیه کار می‌کند. 
1. نرخ داده (\\( R_b \\)) چقدر است؟
2. حداقل پهنای باند مورد نیاز چقدر است؟

**پاسخ:**  
1. نرخ داده:
\\[
R_b = R_s \\times \\log_2(64) = 2 \\times 6 = 12 \\text{ Mbps}
\\]
2. حداقل پهنای باند (با فرض فیلتر ایده‌آل):
\\[
BW = R_s = 2 \\text{ MHz}
\\]
"""))

# سوال 4-4
nb.cells.append(new_markdown_cell("""
### سوال 4: تحلیل خطا در PSK
در یک سیستم BPSK با \\( E_b/N_0 = 10 \\) dB، احتمال خطای بیت (\\( P_e \\)) چقدر است؟ (از فرمول \\( P_e = Q(\\sqrt{2E_b/N_0}) \\) استفاده کنید.)

**پاسخ:**  
\\[
10 \\text{ dB} = 10 \\implies \\sqrt{2 \\times 10} = \\sqrt{20} \\approx 4.472
\\]
\\[
P_e = Q(4.472) \\approx 3.87 \\times 10^{-6} \\text{ (از جدول تابع Q)}
\\]
"""))

# سوال 4-5
nb.cells.append(new_markdown_cell("""
### سوال 5: طراحی سیستم FSK
می‌خواهیم یک سیستم FSK طراحی کنیم با مشخصات زیر:
- نرخ داده: 1 Mbps
- فاصله فرکانسی بین سمبل‌ها: 500 kHz
- فرکانس حامل: 100 MHz

1. فرکانس‌های مورد استفاده برای نمایش 0 و 1 را محاسبه کنید.
2. پهنای باند تقریبی را بر اساس قاعده کارسون محاسبه کنید.

**پاسخ:**  
1. فرکانس‌ها:
\\[
f_0 = f_c - \\frac{\\Delta f}{2} = 100 - 0.25 = 99.75 \\text{ MHz}
\\]
\\[
f_1 = f_c + \\frac{\\Delta f}{2} = 100 + 0.25 = 100.25 \\text{ MHz}
\\]

2. پهنای باند:
\\[
BW = 2\\Delta f + 2R_b = 2 \\times 500 \\text{ kHz} + 2 \\times 1 \\text{ MHz} = 1 \\text{ MHz} + 2 \\text{ MHz} = 3 \\text{ MHz}
\\]
"""))

# سری 5
nb.cells.append(new_markdown_cell("## سری 5: مسائل ترکیبی و چالشی"))

# سوال 5-1
nb.cells.append(new_markdown_cell("""
### سوال 1: مدولاسیون AM و محاسبه بازده
یک سیگنال AM با معادله \\( s(t) = 10[1 + 0.5\\cos(2\\pi 1000 t)]\\cos(2\\pi 10^6 t) \\) داده شده است. 
1. بازده توان مدولاسیون (\\( \\eta \\)) را محاسبه کنید.
2. اگر گیرنده فقط به باند جانبی بالا حساس باشد، بازده چقدر می‌شود؟

**پاسخ:**  
1. بازده معمولی:
\\[
\\eta = \\frac{\\mu^2}{2 + \\mu^2} \\times 100\\% = \\frac{0.25}{2.25} \\times 100\\% \\approx 11.11\\%
\\]

2. برای USB:
\\[
\\eta_{USB} = \\frac{\\mu^2/4}{1 + \\mu^2/2} \\times 100\\% = \\frac{0.0625}{1.125} \\times 100\\% \\approx 5.56\\%
\\]
"""))

# سوال 5-2
nb.cells.append(new_markdown_cell("""
### سوال 2: محاسبه BER در حضور نویز
یک سیستم QPSK با نرخ داده 6 Mbps در کانالی با \\( E_b/N_0 = 8 \\) dB کار می‌کند. احتمال خطای سمبل (\\( P_e \\)) را محاسبه کنید. (از فرمول \\( P_e \\approx 2Q(\\sqrt{2E_b/N_0} \\sin(\\pi/M)) \\) برای QPSK استفاده کنید.)

**پاسخ:**  
\\[
8 \\text{ dB} = 6.31 \\implies \\sqrt{2 \\times 6.31} \\times \\sin(\\pi/4) \\approx 3.55 \\times 0.707 \\approx 2.51
\\]
\\[
P_e \\approx 2Q(2.51) \\approx 2 \\times 0.006 = 0.012 \\text{ یا } 1.2\\%
\\]
"""))

# سوال 5-3
nb.cells.append(new_markdown_cell("""
### سوال 3: طراحی سیستم OFDM
یک سیستم OFDM دارای 64 زیرحامل با فاصله 15 kHz است. 
1. پهنای باند کل سیستم چقدر است؟
2. اگر از 16-QAM استفاده شود و نرخ داده هر زیرحامل 60 kbps باشد، نرخ داده کل چقدر است؟

**پاسخ:**  
1. پهنای باند:
\\[
BW = N \\times \\Delta f = 64 \\times 15 \\text{ kHz} = 960 \\text{ kHz}
\\]

2. نرخ داده کل:
\\[
R_b = 64 \\times 60 \\text{ kbps} = 3.84 \\text{ Mbps}
\\]
"""))

# ذخیره فایل
with open('سوالات_پیشرفته_مخابراتی.ipynb', 'w', encoding='utf-8') as f:
    nbf.write(nb, f)

print("فایل Jupyter Notebook با موفقیت ایجاد شد!")